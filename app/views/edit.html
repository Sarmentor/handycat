  <!-- TODO: show the relevant content when the tab is active - put inside tab.content? -->
<div class="container" ng-controller="TabsCtrl">
    <div>
      <!--<tabset justified="true">-->
        <!--<tab ng-repeat="tab in tabs" heading="{{tab.title}}" active="tab.active" disabled="tab.disabled"></tab>-->
      <!--</tabset>-->
        <!-- TODO: use nav here, not tabs -->
    </div>

    <!-- TODO: add feature where dragging a word or phrase to target area translates it automatically -->
    <!-- UPDATE: use glossary for the 'add word' feature -->
    <!-- TODO: markup target content using highlight rules -->
    <!-- TODO: get the TM matches for the source segment -->

    <!-- translation area -->
    <div class="edit-area-wrapper" ng-controller="ContentAreaCtrl" ng-show="tabs[0].active">
        <div class="segment row" ng-controller="SegmentAreaCtrl" ng-repeat="seg in segments" ng-init="segment = seg">
            <a id="segment-{{$index}}"></a>
            <p class="segment-index-label">Segment Index: {{$index}}</p>
            <!-- TODO - WORKING: move the AceCtrl only to the Ace edit area, and nest controllers within the translation unit -->
            <div class="container bottom-margin" >
                <div class="row">
                    <!-- used with $anchorScroll from ContentAreaCtrl -->
                    <!-- TODO: prevent $anchorScroll from reloading the ng-repeat -->

                    <div class="col-sm-6 bottom-margin">
                        <div class="row">
                            <div class="col-xs-12">
                                <div class="content-card">
                                    <source-area source-sentence="segment.source" class="source"></source-area>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="row">
                            <div class="col-xs-12">
                                <div ng-controller="AceCtrl" index="{{$index}}" class="content-card">
                                    <!-- the ace editor -->
                                    <div class="ace_editor target" id="ace_editor-{{$index}}" ng-model="segment.target" ui-ace="{ onLoad : aceLoaded }"></div>
                                    <!--<div chars class="sample-show-hide" collapsed="showSpecialChars" special="germanChars" selected="insertChar(char)" ></div>-->
                                </div>
                            </div>
                        </div>

                        <div ng-show="selectedToken">
                            <div class="row row-padded">
                                <div class="col-xs-1">
                                    <button ng-click="changeTokenNumber()" tooltip="change the number of the selected phrase" class="btn btn-primary morph-glyph"><span>#</span></button>
                                </div>
                                <div class="col-xs-1">
                                    <button type="button" class="btn btn-primary morph-glyph" tooltip="change gender of the selected phrase" ng-click="toggleMorphologyMenu()">
                                        <!--<span class="icon ion-male"></span>-->
                                        <span>G</span>
                                    </button>
                                </div>
                                <div class="col-xs-1">
                                    <button type="button" ng-click="toggleMorphologyMenu()" class="btn btn-primary morph-glyph" tooltip="change case of the selected phrase">
                                        <span>C</span>
                                    </button>
                                </div>
                            </div>

                            <!--<div ng-show="changeGenderClicked">-->
                                <!--<div class="row btn-group" style="width:100%">-->
                                    <!--<button type="button" class="btn btn-primary" ng-model="selGender" btn-radio="'masculine'">Masculine</button>-->
                                    <!--<button type="button" class="btn btn-primary" ng-model="selGender" btn-radio="'femenine'">Femenine</button>-->
                                    <!--<button type="button" class="btn btn-primary" ng-model="selGender" btn-radio="'neuter'">Neuter</button>-->
                                <!--</div>-->

                                <!--<div class="row btn-group" style="width:100%">-->
                                    <!--<button type="button" class="btn btn-primary" ng-model="selNumber" btn-radio="'Masc'">Singlar</button>-->
                                    <!--<button type="button" class="btn btn-primary" ng-model="selNumber" btn-radio="'Fem'">Plural</button>-->
                                <!--</div>-->

                                <!--<div class="row btn-group" style="width:100%">-->
                                    <!--<button type="button" class="btn btn-primary" ng-model="selCase" btn-radio="'nominative'">Nominative</button>-->
                                    <!--<button type="button" class="btn btn-primary" ng-model="selCase" btn-radio="'accusative'">Accusative</button>-->
                                    <!--<button type="button" class="btn btn-primary" ng-model="selCase" btn-radio="'dative'">Dative</button>-->
                                    <!--<button type="button" class="btn btn-primary" ng-model="selCase" btn-radio="'genitive'">Genitive</button>-->
                                <!--</div>-->

                            <!--</div>-->
                        </div>
                        <div class="row">
                            <div class="col-xs-offset-1 col-xs-2 text-right">
                                <button ng-click="segmentFinished()" tooltip="segment complete" class="btn btn-primary cat-glyph"><span class="glyphicon glyphicon-ok-sign"></span></button>
                            </div>
                            <div class="col-xs-2 text-right">
                                <button ng-click="copySourcePunctuation()" tooltip="copy punctuation from source" class="btn btn-primary cat-glyph"><span class="glyphicon glyphicon-share-alt"></span></button> 
                            </div>
                            <div class="col-xs-2 text-right">
                                <button ng-click="clearEditor()" tooltip="reject MT output" class="btn btn-primary cat-glyph"><span class="glyphicon glyphicon-remove"></span></button>
                            </div>
                            <div class="col-xs-2 text-right">
                                <button ng-click="toggleToolbar()" tooltip="toggle toolbar" class="btn btn-primary cat-glyph"><span class="glyphicon glyphicon-wrench"></span></button>
                            </div>
                            <div class="col-xs-2 text-right">
                                <button ng-click="nextMTSuggestion()" tooltip="next MT suggestion" class="btn btn-primary cat-glyph"><span class="glyphicon glyphicon-flash"></span></button>
                            </div>
                            <!--<button ng-click="showSpecialChars = !showSpecialChars" class="btn btn-primary pull-right"><span>Show special</span></button>-->
                        </div>
                    </div>
                </div>
            </div>
            <!-- The tools for editing -->
            <!-- TODO: should these tools really be repeated, or should there be a single instance for the whole document? -->
            <!--<div class="ace-toolbar container" ng-show="toolbarOpen" collapse="toolbarOpen">-->
            <div class="ace-toolbar container" collapse="isCollapsed['collapsed']">
                <div
                    class="translation-toolbar"
                >
                <!-- Working - move to tabset -->
                <!-- Working - Add smart pluralize here first, then move to the edit area -->
                <!-- TODO - make tabs active based on edit-area interactions -->
                    <tabset>
                        <tab heading="Glossary" ng-click="">
                            <input type="text" ng-model="glossary.glossaryQuery" placeholder="Enter a search query..." /><button ng-click="queryGlossary(glossary.glossaryQuery)" class="btn btn-success"><span class="glyphicon glyphicon-search"></span></button>
                            <div class="search-result"
                                 ng-repeat="glossaryMatch in glossaryMatches"
                                 ng-click="insertText(glossaryMatch)"
                                 ng-show="glossaryMatches"
                            >{{glossaryMatch}}</div>

                            <div ng-hide="glossaryMatches !== undefined"><p>Error: Unable to access the glossary service.</p></div>
                            <div ng-show="glossaryMatches.length === 0"><p>No matches found for term: <b>{{ glossary.glossaryQuery }}</b></p></div>
                        </tab>
                        <tab heading="Concordance" ng-click="">
                            <input type="text" ng-model="concordanceQuery" placeholder="Enter a search query..." />
                            <button ng-click="queryConcordancer(concordanceQuery, queryLang)" class="btn btn-success"><span class="glyphicon glyphicon-search"></span></button>
                            <div class="btn-group">
                                <button type="button" class="btn btn-primary lang-select" btn-radio="'en'" ng-model="queryLang">EN</button>
                                <button type="button" class="btn btn-primary lang-select" btn-radio="'de'" ng-model="queryLang">DE</button>
                            </div>
                            <div class="search-result"
                                 ng-repeat="concordanceMatch in concordanceMatches"
                                 ng-bind-html="getSnippet({{concordanceMatch}})"
                                 ng-hide="concordancerError"
                            ></div>

                            <div ng-show="concordancerError"><p>Error: Unable to access the concordance service.</p></div>
                        </tab>
                        <tab heading="WordForms">
                            <div class="word-forms">
                                <div
                                        ng-repeat="word in otherWordForms"
                                >
                                    <button class="btn btn-default" ng-click="replaceSelection(word)">{{word}}</button>
                                </div>
                            </div>
                        </tab>
                        <tab heading="Edit history">
                            <div class="edit-history">
                                <p>List of edits performed in this segment</p>

                                <div ng-repeat="edit in editHistory">
                                    {{edit.description}} <button ng-click="propagateEdit($index)">Propagate</button>
                                </div>
                            </div>

                        </tab>
                    </tabset>

                </div>
            </div>
        <hr/>
        </div>
    </div>
</div>
